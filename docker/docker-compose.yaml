services:
  pf-builder:
    build:
      context: ../
      dockerfile: docker/Dockerfile
    image: static-portfolio-builder:latest
    container_name: portfolio-builder
    ports:
      - "3300:3000"

    user: "100:101"

    # Security hardening
    read_only: true
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true

    tmpfs:
      - /tmp

    volumes:
      - /var/www/portfolios:/var/www/portfolios:rw

    env_file:
      - ../.env.${ENV:-local}
   
    restart: unless-stopped

    # Optional: resource limits to prevent abuse
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
